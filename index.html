<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pancake Pandemonium</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<style>
:root { font-size: 20px; }
body { margin:0; font-family: 'Trebuchet MS', sans-serif; background:#fff7e6; overflow-x:hidden; }

#app { padding: 10px; }

table { width:100%; table-layout:fixed; border-collapse:separate; border-spacing:10px; }
th { width:20%; position:relative; color:white; padding:20px; border-radius:20px; cursor:pointer; transition:transform .25s ease, box-shadow .25s ease; }
th:hover { transform:scaleX(1.08); box-shadow:0 10px 25px rgba(0,0,0,.25); }

.team-name { font-size:2rem; text-shadow:2px 2px 4px rgba(0,0,0,.35); }
.score { font-size:2.5rem; margin-top:10px; }

.edit-btn {
 position:absolute; bottom:8px; right:10px; font-size:1rem; opacity:.7;
}

.menu {
 position:fixed; top:80px; left:50%; transform:translateX(-50%);
 width:80%; background:white; border-radius:20px; padding:20px;
 display:flex; gap:20px; box-shadow:0 20px 50px rgba(0,0,0,.3);
 z-index:100;
}
.menu-column { flex:1; max-height:60vh; overflow-y:auto; }
.menu h3 { margin-top:0; }
button { font-size:1rem; margin:6px 0; padding:8px; width:100%; }
button.used { background:#ccc; color:#666; }

.badges { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; min-height:50px; }
.badge {
 width:42px; height:42px; border-radius:50%; background:#ffd54f;
 display:flex; align-items:center; justify-content:center;
 font-size:1.2rem; transform:translateY(0);
}
.badge:nth-child(even){ transform:translateY(8px); }

.flash { animation:flash 0.6s alternate 4; }
@keyframes flash { from{filter:brightness(1);} to{filter:brightness(1.6);} }

.reset-btn { position:fixed; bottom:10px; right:10px; padding:8px 14px; }

.leaderboard-move { transition:all .6s cubic-bezier(.2,.8,.2,1); }
</style>
</head>
<body>
<div id="app">

<table>
<tr>
<th v-for="team in orderedTeams"
    :key="team.id"
    class="leaderboard-move"
    :class="{flash:team.flash}"
    :style="{background:team.color}"
    @click="openMenu(team)">

<div class="team-name">{{team.name}}</div>
<div class="score">{{team.score}}</div>
<div class="badges">
<div v-for="b in team.badges" class="badge">ü•û</div>
</div>

<div class="edit-btn" @click.stop="editName(team)">‚úè</div>
</th>
</tr>
</table>

<div v-if="activeTeam" class="menu" @click.stop>
<div class="menu-column">
<h3>Points</h3>
<button v-for="task in tasks" :class="{used:isUsed(activeTeam,task)}"
 @click="doTask(activeTeam,task)">
{{task.name}} ({{task.points}})
</button>
</div>
<div class="menu-column">
<h3>Shop</h3>
<button v-for="item in shop"
 :class="{used:isUsed(activeTeam,item)}"
 @click="buyItem(activeTeam,item)">
{{item.name}} (-{{item.points}})
</button>
</div>
</div>

<button class="reset-btn" @click="startReset">Reset</button>

<div v-if="resetMode" class="menu">
<div>
<p>Type this code to reset:</p>
<h2>{{resetCode}}</h2>
<input ref="resetInput" v-model="resetEntry" />
<button @click="confirmReset">Confirm</button>
</div>
</div>

<button style="position:fixed;left:10px;bottom:10px" @click="undo">Undo</button>

</div>

<script>
const {createApp,nextTick} = Vue;

createApp({
data(){
return{
teams:[
{id:1,name:'Blue',color:'#42a5f5',score:0,badges:[],used:[],flash:false},
{id:2,name:'Red',color:'#ef5350',score:0,badges:[],used:[],flash:false},
{id:3,name:'White',color:'#bdbdbd',score:0,badges:[],used:[],flash:false},
{id:4,name:'Yellow',color:'#ffeb3b',score:0,badges:[],used:[],flash:false},
{id:5,name:'Green',color:'#66bb6a',score:0,badges:[],used:[],flash:false}
],
activeTeam:null,
undoStack:[],
resetMode:false,resetCode:'',resetEntry:'',

// lightweight "remote" sync using BroadcastChannel (works across devices if same URL open)
channel:new BroadcastChannel('pancake-remote'),


tasks:[
{name:'Make a pancake',points:10,repeat:true},
{name:'Wonky pancake',points:8,repeat:true},
{name:'5 stack',points:20,repeat:true},
{name:'10 stack',points:50,repeat:true},
{name:'Answer question',points:10,repeat:true},
{name:'Flip & catch',points:50,repeat:false}
],
shop:[
{name:'Matchstick',points:2,repeat:true},
{name:'Ultimate set',points:50,repeat:false}
]
}
},
computed:{
orderedTeams(){
return [...this.teams].sort((a,b)=>b.score-a.score);
}
},
mounted(){
document.addEventListener('click',()=>this.closeMenu());
this.channel.onmessage=(e)=>this.applyRemote(e.data);
},
methods:{
openMenu(team){this.activeTeam=team;},
closeMenu(){this.activeTeam=null;},

queueEffect(fn){
setTimeout(fn,200); // ensures menus closed first
},

saveUndo(){this.undoStack.push(JSON.stringify(this.teams));},
undo(){if(this.undoStack.length)this.teams=JSON.parse(this.undoStack.pop());},

isUsed(team,item){return team.used.includes(item.name);},


doTask(team,task){
if(!task.repeat && this.isUsed(team,task))return;
this.saveUndo();
team.score+=task.points;
if(!task.repeat){team.used.push(task.name);team.badges.push(task.name);} 
this.finishAction();
},

buyItem(team,item){
if(team.score<item.points)return;
if(!item.repeat && this.isUsed(team,item))return;
this.saveUndo();
team.score-=item.points;
if(!item.repeat)team.used.push(item.name);
this.finishAction();
},

finishAction(){
this.closeMenu();
this.queueEffect(()=>this.checkLeaders());
this.broadcast();
},

checkLeaders(){
const max=Math.max(...this.teams.map(t=>t.score));
const leaders=this.teams.filter(t=>t.score===max && max>0);
leaders.forEach(t=>{t.flash=true;setTimeout(()=>t.flash=false,2500);});
},

editName(team){
const name=prompt('Team name:',team.name);
if(name)team.name=name;
},

startReset(){
this.resetCode=Math.floor(100+Math.random()*900).toString();
this.resetMode=true;
this.$nextTick(()=>this.$refs.resetInput.focus());
},
confirmReset(){
if(this.resetEntry===this.resetCode){location.reload();}
},

broadcast(){this.channel.postMessage(this.teams);},
applyRemote(data){this.teams=data;}
}
}).mount('#app');
</script>
</body>
</html>
