<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pancake Pandemonium</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

<style>
:root { font-size: 20px; }
body { font-family: "Comic Sans MS", cursive, sans-serif; background: linear-gradient(135deg,#ffb347,#ffcc33); margin:0; padding:40px; }
h1 { text-align:center; font-size:4rem; color:#fff; text-shadow:3px 3px #ff4081; }

table { width:100%; table-layout:fixed; border-collapse:collapse; background:white; border-radius:20px; overflow:hidden; box-shadow:0 10px 25px rgba(0,0,0,.2); }
th, td { width:20%; padding:25px; text-align:center; vertical-align:top; }
th { cursor:pointer; color:white; position:relative; transition: transform .2s ease, z-index 0s; }
th:hover { transform: scale(1.1); z-index: 10; }

.team-name { font-size:2.3rem; font-weight:bold; text-shadow:2px 2px 4px rgba(0,0,0,.35); }

/* Discrete pencil button */
.edit-btn {
  position:absolute;
  bottom:6px;
  right:6px;
  width:22px;
  height:22px;
  border:none;
  padding:0;
  background:transparent;
  cursor:pointer;
  opacity:.6;
}
.edit-btn:hover { opacity:1; }
.edit-btn svg { width:100%; height:100%; fill:rgba(0,0,0,.35); }

.score { font-size:2.5rem; font-weight:bold; }

/* Circular achievement badges */
.badges-row {
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}
.badge-icon {
  width:46px;
  height:46px;
  border-radius:50%;
  overflow:hidden;
  border:3px solid #fff;
  box-shadow:0 2px 6px rgba(0,0,0,.3);
  margin:4px;
}
.badge-icon:nth-child(odd){ margin-top:12px; } /* stagger effect */
.badge-icon img { width:100%; height:100%; object-fit:cover; }

@keyframes flash { 0%{filter:brightness(1);} 50%{filter:brightness(2.2);} 100%{filter:brightness(1);} }
.flash { animation: flash .6s ease-in-out 4; }

@keyframes bigFlash { 0%{filter:brightness(1);} 50%{filter:brightness(3);} 100%{filter:brightness(1);} }
@keyframes expandContract { 0%{transform:scale(1);} 25%{transform:scale(1.3);} 50%{transform:scale(1);} 75%{transform:scale(1.3);} 100%{transform:scale(1);} }
.new-leader { animation: bigFlash .8s ease-in-out 6, expandContract .8s ease-in-out 6; }

.overlay { position:fixed; inset:0; background:rgba(0,0,0,.25); display:flex; align-items:flex-start; justify-content:center; padding-top:5vh; }
.menu { width:70vw; max-width:900px; background:white; border-radius:20px; padding:20px; box-shadow:0 20px 50px rgba(0,0,0,.4); }
.menu-columns { display:flex; gap:20px; }
.menu-section { flex:1; max-height:60vh; overflow-y:auto; border:2px dashed #ffd54f; border-radius:15px; padding:15px; }

button { width:100%; margin:6px 0; padding:14px; border:none; border-radius:12px; font-size:1rem; cursor:pointer; background:#ffcc00; }
button:hover { background:#ff9800; }
button.used { background:#ccc; cursor:not-allowed; }
.close { background:#ff4081; color:white; }

.reset-btn { position:fixed; bottom:12px; right:12px; width:auto; padding:8px 14px; font-size:.85rem; opacity:.7; }
.undo-btn { position:fixed; bottom:12px; left:12px; width:auto; padding:8px 14px; font-size:.85rem; opacity:.7; }
.undo-btn:disabled { opacity:.3; cursor:not-allowed; background:#cccccc !important; }
.reset-box { background:white; padding:25px; border-radius:15px; text-align:center; }
.answer-btn { width:48%; margin:10px 1%; padding:14px; }
input { font-size:1.2rem; padding:8px; margin-top:10px; }

@keyframes resultFlash { 0%{opacity:1; transform:scale(0.8);} 50%{opacity:1; transform:scale(1.2);} 100%{opacity:0; transform:scale(1);} }
.result-display { position:fixed; font-size:4rem; font-weight:bold; text-shadow:3px 3px 6px rgba(0,0,0,.5); z-index:100; animation:resultFlash 1.5s ease-out forwards; }
.result-correct { color:#4caf50; }
.result-incorrect { color:#f44336; }

/* Inspection banner */
.inspection-banner { position:fixed; top:0; left:0; right:0; height:48px; background:#ff7043; color:#fff; display:flex; align-items:center; overflow:hidden; z-index:300; box-shadow:0 6px 14px rgba(0,0,0,.25); }
.inspection-marquee { white-space:nowrap; display:inline-block; padding-left:100%; font-size:1.1rem; animation:inspection-scroll 12s linear infinite; }
@keyframes inspection-scroll { from { transform:translateX(0); } to { transform:translateX(-100%); } }

/* Alert button (center bottom) */
.alert-btn { position:fixed; bottom:12px; left:50%; transform:translateX(-50%); width:auto; padding:0px 0px; background:#ffcc0000; font-size:1.8rem; border-radius:12px; cursor:pointer; }
.alert-btn:hover { background:#ff9800; }
</style>
</head>

<body>
<div id="app">

<h1>ü•û Pancake Pandemonium ü•û</h1>

<div v-if="resultMessage" :class="['result-display', resultMessage.correct ? 'result-correct' : 'result-incorrect']" :style="{top: resultMessage.top, left: resultMessage.left, transform: 'translate(-50%, -50%)'}">
  {{resultMessage.correct ? 'CORRECT' : 'INCORRECT'}}
</div>

<!-- Inspection banner -->
<div v-if="inspectionActive" class="inspection-banner">
  <div class="inspection-marquee">
    üößüößüöß THE INSPECTION IS IMMINENT! üößüößüöß &nbsp; (starts in {{ formatTime(inspectionRemaining) }}) &nbsp; üößüößüöß THE INSPECTION IS IMMINENT! üößüößüöß &nbsp;
  </div>
</div>

<table>
<tr>
  <th v-for="team in teams"
      :key="team.id"
      :class="{flash: flashingTeams.includes(team.id), 'new-leader': newLeaderId === team.id}"
      :style="{background: team.color}"
      @click="openMenu(team)">

      <div class="team-name">{{team.name}}</div>

      <!-- small darker-shade pencil -->
      <button class="edit-btn" @click.stop="editTeam(team)" title="Rename team">
        <svg viewBox="0 0 24 24">
          <path d="M3 17.25V21h3.75L19.81 7.94l-3.75-3.75L3 17.25zm18-11.5a1 1 0 0 0 0-1.41l-1.34-1.34a1 1 0 0 0-1.41 0l-1.13 1.13 3.75 3.75L21 5.75z"/>
        </svg>
      </button>
  </th>
</tr>

<tr>
  <td v-for="team in teams">
    <div class="score">{{team.score}}</div>

    <!-- Achievements now live under the points -->
    <div class="badges-row">
      <div v-for="badge in team.badges" class="badge-icon">
        <img :src="badgeImages[badge]" :title="badge" />
      </div>
    </div>
  </td>
</tr>
</table>

<button class="reset-btn" @click="openReset">Reset</button>
<button class="undo-btn" @click="undo" :disabled="undoStack.length === 0">‚Ü∂ Undo</button>
<button v-if="!inspectionActive && !inspectionHasBeenTriggered" class="alert-btn" @contextmenu.prevent.stop="startInspection">üö®</button>

<!-- TEAM MENU -->
<div v-if="activeTeam" class="overlay" @click.self="closeMenuAndExecuteDeferred">
  <div class="menu">
    <h2>{{activeTeam.name}} Team</h2>

    <div class="menu-columns">
      <div class="menu-section">
        <h3>Points</h3>
        <strong>Repeatable</strong>
        <button v-for="task in repeatableTasks" @click="addPoints(task)">{{task.name}} (+{{task.points}})</button>

        <strong>One-Off Bonuses</strong>
        <button v-for="task in oneOffTasks"
          :class="{used: activeTeam.usedTasks.includes(task.name)}"
          :disabled="activeTeam.usedTasks.includes(task.name)"
          @click="completeOneOff(task); closeMenuAndExecuteDeferred()">
          {{task.name}} (+{{task.points}})
        </button>
      </div>

      <div class="menu-section">
        <h3>Shop</h3>
        <strong>Repeatable</strong>
        <button v-for="item in shopRepeatable" @click="buyItem(item)">{{item.name}} (-{{item.cost}})</button>

        <strong>One-Off</strong>
        <button v-for="item in shopOneOff"
          :class="{used: activeTeam.usedShop.includes(item.name)}"
          :disabled="activeTeam.usedShop.includes(item.name)"
          @click="buyOneOff(item)">
          {{item.name}} (-{{item.cost}})
        </button>
      </div>
    </div>

    <button class="close" @click="closeMenuAndExecuteDeferred">Close</button>
  </div>
</div>

<!-- QUESTION MODAL -->
<div v-if="showQuestion" class="overlay" @click.self="showQuestion=false">
  <div class="reset-box">
    <h3>{{currentQuestion?.question}}</h3>
    <button @click="answerQuestion(true)" class="answer-btn">True</button>
    <button @click="answerQuestion(false)" class="answer-btn">False</button>
  </div>
</div>

<!-- RESET CONFIRM -->
<div v-if="showReset" class="overlay" @click.self="showReset=false">
  <div class="reset-box">
    <h3>Type this code to reset:</h3>
    <h2>{{resetCode}}</h2>
    <input ref="resetInput" v-model="resetInput" placeholder="Enter code" @keydown.enter="confirmReset" @keydown.esc="showReset=false" />
    <br><br>
    <button @click="confirmReset">Confirm Reset</button>
  </div>
</div>

</div>

<script>
/* Web Audio sound effects */
class SoundFX {
  constructor(){ this.ctx=null; }
  ensure(){ if(!this.ctx){ this.ctx=new(window.AudioContext||window.webkitAudioContext)(); } if(this.ctx.state==='suspended') this.ctx.resume(); }
  tone(f,d,t='sine',v=.2){ this.ensure(); const o=this.ctx.createOscillator(); const g=this.ctx.createGain(); o.type=t; o.frequency.value=f; g.gain.value=v; o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+d); }
  earn(){
    const t = (delay, freq, duration, type='sine') => setTimeout(() => this.tone(freq, duration, type), delay);
    
    // Opening flourish - ascending
    t(0, 523, 0.1, 'sine');      // C5
    t(120, 659, 0.1, 'sine');    // E5
    t(240, 1047, 0.4, 'sine');   // C6 (high)
  }
  spend(){ 
    const t = (delay, freq, duration, type='sine') => setTimeout(() => this.tone(freq, duration, type), delay);
    t(0, 523, 0.1, 'sine');
    t(120, 494, 0.1, 'sine');
    t(240, 330, 0.15, 'sine');
  }
  win(){
    // Exciting ascending fanfare that lasts ~4.8 seconds
    const t = (delay, freq, duration, type='sine') => setTimeout(() => this.tone(freq, duration, type), delay);
    
    // Opening flourish - ascending
    t(0, 523, 0.1, 'sine');      // C5
    t(120, 659, 0.1, 'sine');    // E5
    t(240, 784, 0.15, 'sine');   // G5
    t(400, 1047, 0.2, 'sine');   // C6 (high)
    
    // Fast descending pattern for drama
    t(650, 784, 0.08, 'square');
    t(750, 659, 0.08, 'square');
    t(850, 784, 0.08, 'square');
    t(950, 523, 0.12, 'square');
    
    // Ascending again - even more exciting
    t(1150, 523, 0.1, 'triangle');
    t(1270, 659, 0.1, 'triangle');
    t(1390, 784, 0.1, 'triangle');
    t(1510, 1047, 0.15, 'triangle');
    t(1700, 1319, 0.2, 'triangle'); // E6 (very high)
    
    // Quick flourish - rapid notes
    t(1950, 1047, 0.06, 'sine');
    t(2050, 1175, 0.06, 'sine');
    t(2150, 1319, 0.08, 'sine');
    t(2280, 1047, 0.08, 'sine');
    t(2400, 784, 0.12, 'sine');
    
    // Triumphant middle section - solid tones
    t(2600, 659, 0.15, 'sine');
    t(2800, 784, 0.15, 'sine');
    t(3000, 1047, 0.2, 'sine');
    
    // Accelerating pattern toward climax
    t(3250, 1319, 0.08, 'triangle');
    t(3370, 1175, 0.08, 'triangle');
    t(3490, 1319, 0.08, 'triangle');
    t(3610, 1047, 0.1, 'triangle');
    
    // Grand finale - sustained high note with supporting harmonics
    t(3800, 1047, 0.4, 'sine');    // Hold high C
    t(3800, 659, 0.4, 'sine');     // Harmonic underneath
    t(3800, 1319, 0.35, 'sine');   // Even higher note
  }
  claxon(){
    // A short horn/claxon sequence
    this.tone(220,0.18,'square',0.7);
    setTimeout(()=>this.tone(330,0.22,'square',0.7),180);
    setTimeout(()=>this.tone(440,0.28,'square',0.6),360);
  }

  explosion(){
    // Loud explosion effect with descending bass and sharp burst
    // Initial bass boom - very low frequency, loud
    this.tone(80, 0.8, 'square', 0.95);
    // High-frequency burst for impact
    this.tone(1200, 0.60, 'triangle', 0.8);
    // Descending frequencies simulating echo/falloff
    setTimeout(()=>this.tone(600, 0.2, 'sine', 0.7), 500);
    setTimeout(()=>this.tone(300, 0.25, 'sine', 0.6), 600);
    setTimeout(()=>this.tone(150, 0.3, 'sine', 0.4), 750);
  }

  startDrums(endTimestamp){
    // Iconic Jaws theme: alternating low-high tone pairs with accelerating rhythm
    if(this._drumLoop) this.stopDrums();
    const start = Date.now();
    const total = Math.max(1, endTimestamp - start);
    this._drumLoop = { timer: null, running: true };

    const jaws = () => {
      if(!this._drumLoop || !this._drumLoop.running) return;
      const remaining = Math.max(0, endTimestamp - Date.now());
      if(remaining <= 0){ this.stopDrums(); return; }
      // interval: speeds up from slow to fast as time runs out
      const min = 240; // fastest interval ms
      const max = 4800; // slowest interval ms
      const ratio = remaining / total; // 1 -> 0
      const interval = Math.round(min + ratio * (max - min));

      // iconic low-high alternating pair: low note gets shorter as interval shrinks, high note stays constant
      const durationLow = Math.max(0.1, interval / 1000 * 0.4); // low note duration scales with interval (in seconds)
      const durationHigh = 0.15; // high note always 150ms
      this.tone(164.81, durationLow, 'sine', 0.8);    // low (E below middle C)
      this.tone(196, durationLow, 'triangle', 0.8);
      this.tone(246.94, durationLow, 'sine', 0.8);
      setTimeout(()=> this.tone(174.61, durationHigh, 'sine', 0.8), Math.round(durationLow * 1000) + 30); // high (B3) after low note completes
      setTimeout(()=> this.tone(220, durationHigh, 'triangle', 0.8), Math.round(durationLow * 1000) + 30);
      setTimeout(()=> this.tone(261.63, durationHigh, 'sine', 0.8), Math.round(durationLow * 1000) + 30);
      this._drumLoop.timer = setTimeout(jaws, interval);
    };
    jaws();
  }

  stopDrums(){
    if(this._drumLoop){ clearTimeout(this._drumLoop.timer); this._drumLoop.running = false; this._drumLoop = null; }
  }
}
const sfx=new SoundFX();

const { createApp } = Vue;

createApp({
data(){
const savedTeams = JSON.parse(localStorage.getItem('pp_teams')) || [
    {id:1,name:'Blue',color:'#2196f3',score:0,badges:[],usedTasks:[],usedShop:[],answeredQuestions:[]},
    {id:2,name:'Red',color:'#f44336',score:0,badges:[],usedTasks:[],usedShop:[],answeredQuestions:[]},
    {id:3,name:'White',color:'#9e9e9e',score:0,badges:[],usedTasks:[],usedShop:[],answeredQuestions:[]},
    {id:4,name:'Yellow',color:'#ffeb3b',score:0,badges:[],usedTasks:[],usedShop:[],answeredQuestions:[]},
    {id:5,name:'Green',color:'#4caf50',score:0,badges:[],usedTasks:[],usedShop:[],answeredQuestions:[]}
  ];
// Ensure all teams have answeredQuestions property
savedTeams.forEach(team => { if(!team.answeredQuestions) team.answeredQuestions = []; });
return {
  teams: savedTeams,

activeTeam:null,
deferredSoundType:null,
flashingTeams:[],
newLeaderId:null,
lastMaxScore:0,
lastLeaderIds:[],
undoStack:[],

showReset:false,
resetCode:'',
resetInput:'',

showQuestion:false,
currentQuestion:null,
resultMessage:null,

inspectionActive:false,
inspectionEnd:0,
inspectionTimerId:null,
inspectionRemaining:0,
inspectionHasBeenTriggered:JSON.parse(localStorage.getItem('pp_inspection_used') || 'false'),

questions:[
  {question:'All snakes are poisonous.',answer:false},
  {question:'Lightning is caused by ripples travelling through clouds.',answer:true},
  {question:'All spiders spin webs.',answer:false},
  {question:'The Great Wall of China is visible from space.',answer:false},
  {question:'Bananas grow on trees.',answer:false},
  {question:'Water boils at a lower temperature on a mountain.',answer:true},
  {question:'Humans have more than 5 senses.',answer:true},
  {question:'Goldfish have a 3-second memory.',answer:false},
  {question:'The Earth is closer to the Sun than the Moon.',answer:true},
  {question:'Bats are blind.',answer:false},
  {question:'Alligators are amphibians.',answer:false},
  {question:'Spiders are insects.',answer:false}
],

/* simple inline SVG "images" for achievements */
badgeImages:{
 'Flip & catch':'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="yellowgreen"/><text x="50" y="60" font-size="50" text-anchor="middle">üç≥</text></svg>',
 'Eat a pancake':'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="orchid"/><text x="50" y="60" font-size="50" text-anchor="middle">üçΩÔ∏è</text></svg>',
 'Deliver 3 pancakes':'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="peru"/><text x="50" y="60" font-size="45" text-anchor="middle">üì¶</text></svg>',
 'Scottish delivery':'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="steelblue"/><text x="50" y="60" font-size="45" text-anchor="middle">üé§</text></svg>',
 'High-5 Tea':'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="pink"/><text x="50" y="60" font-size="45" text-anchor="middle">üôå</text></svg>',
 'Clean at inspection':'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="lightgreen"/><text x="50" y="60" font-size="45" text-anchor="middle">üßΩ</text></svg>'
},

repeatableTasks:[
 {name:'Make a pancake',points:10},
 {name:'Make a wonky pancake',points:8},
 {name:'5 pancake stack',points:20},
 {name:'10 pancake stack',points:50}
],

oneOffTasks:[
 {name:'Flip & catch',points:50},
 {name:'Eat a pancake',points:50},
 {name:'Deliver 3 pancakes',points:50},
 {name:'Scottish delivery',points:50},
 {name:'High-5 Tea',points:60},
 {name:'Clean at inspection',points:50}
],

shopRepeatable:[
 {name:'Matchstick',cost:2},
 {name:'Peg',cost:2},
 {name:'Pan',cost:4},
 {name:'Candle',cost:4},
 {name:'Teaspoon',cost:5},
 {name:'2 bottles of mix',cost:15},
 {name:'Bottle of oil',cost:2},
 {name:'Question',cost:5}
],

shopOneOff:[ 
 {name:'Ultimate starter set',cost:50},
 {name:'Matchbox',cost:10}
]
};
},

methods:{
openMenu(team){ sfx.ensure(); this.activeTeam=team; },

editTeam(team){ const n=prompt('Enter new team name:',team.name); if(n&&n.trim()){team.name=n.trim(); this.save();}},

addPoints(task){ this.pushToUndoStack(); this.activeTeam.score+=task.points; this.deferredSoundType='earn'; },

completeOneOff(task){
 if(this.activeTeam.usedTasks.includes(task.name)) return;
 this.pushToUndoStack();
 this.activeTeam.score+=task.points;
 this.activeTeam.usedTasks.push(task.name);
 this.activeTeam.badges.push(task.name);
 this.deferredSoundType='earn';
},

buyItem(item){ 
  if(this.activeTeam.score<item.cost) return; 
  if(item.name === 'Question') {
    const availableQuestions = this.questions.filter(q => !this.activeTeam.answeredQuestions.includes(q.question));
    if(availableQuestions.length === 0) {
      alert('All questions answered!');
      return;
    }
    this.pushToUndoStack();
    this.activeTeam.score -= item.cost;
    this.currentQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
    this.showQuestion = true;
  } else {
    this.pushToUndoStack();
    this.activeTeam.score -= item.cost;
    this.deferredSoundType = 'spend';
  }
},

buyOneOff(item){
 if(this.activeTeam.usedShop.includes(item.name)||this.activeTeam.score<item.cost) return;
 this.pushToUndoStack();
 this.activeTeam.score-=item.cost;
 this.activeTeam.usedShop.push(item.name);
 this.deferredSoundType='spend';
},

afterScoreChange(){ this.checkLeaders(); this.save(); },

closeMenuAndExecuteDeferred(){
 const soundType = this.deferredSoundType;
 const scoringTeamId = this.activeTeam?.id;
 this.activeTeam = null;
 this.deferredSoundType = null;
 if(soundType) {
   if(soundType === 'earn') sfx.earn();
   else if(soundType === 'spend') sfx.spend();
   this.checkLeaders(scoringTeamId);
   this.save();
 }
},

deferredAfterScoreChange(soundType = 'earn'){
 const updateVisuals = () => {
   if(soundType === 'earn') sfx.earn();
   else if(soundType === 'spend') sfx.spend();
   this.checkLeaders();
   this.save();
 };
 if(this.activeTeam) {
   setTimeout(updateVisuals, 400);
 } else {
   updateVisuals();
 }
},

/* Flash the scoring team and update leaders */
checkLeaders(scoringTeamId){
 const max=Math.max(...this.teams.map(t=>t.score));
 const leaders=this.teams.filter(t=>t.score===max).map(t=>t.id);
 const leadersChanged = JSON.stringify(leaders.sort()) !== JSON.stringify(this.lastLeaderIds.sort());

 if(leadersChanged){ 
   sfx.win(); 
   // Set new leader animation (if only 1 leader, set that; otherwise just use the first one)
   this.newLeaderId = leaders.length === 1 ? leaders[0] : leaders[0];
   setTimeout(() => { this.newLeaderId = null; }, 4800); // Clear after animation completes
 }

 this.flashingTeams = scoringTeamId ? [scoringTeamId] : leaders;
 setTimeout(()=>this.flashingTeams=[],2500);

 this.lastMaxScore=max;
 this.lastLeaderIds=leaders;
},

openReset(){ this.resetCode=Math.random().toString(36).substring(2,4).toLowerCase(); this.resetInput=''; this.showReset=true; this.$nextTick(() => this.$refs.resetInput.focus()); },

confirmReset(){ if(this.resetInput===this.resetCode){ localStorage.removeItem('pp_teams'); localStorage.removeItem('pp_inspection_used'); location.reload(); } else alert('Code incorrect!'); },

pushToUndoStack(){
 this.undoStack.push(JSON.parse(JSON.stringify(this.teams)));
},

undo(){
 if(this.undoStack.length === 0) return;
 this.teams = this.undoStack.pop();
 this.save();
},

answerQuestion(answer){
 if(!this.currentQuestion) return;
 const isCorrect = answer === this.currentQuestion.answer;
 const scoringTeamId = this.activeTeam.id;
 
 // Close all menus
 this.activeTeam = null;
 this.showQuestion = false;
 
 // Handle score and sounds
 if(isCorrect) {
   this.teams.find(t => t.id === scoringTeamId).score += 10;
   this.teams.find(t => t.id === scoringTeamId).answeredQuestions.push(this.currentQuestion.question);
   sfx.earn();
 } else {
   sfx.spend();
 }
 
 this.currentQuestion = null;
 
 // Calculate position of the scoring team header
 this.$nextTick(() => {
   const teamIndex = this.teams.findIndex(t => t.id === scoringTeamId);
   const teamHeaders = document.querySelectorAll('table th');
   if(teamHeaders[teamIndex]) {
     const rect = teamHeaders[teamIndex].getBoundingClientRect();
     this.resultMessage = {
       correct: isCorrect,
       top: (rect.top + rect.height / 2) + 'px',
       left: (rect.left) + 'px'
     };
   }
 });
 
 this.checkLeaders(scoringTeamId);
 this.save();
 
 // Clear result message after animation completes
 setTimeout(() => { this.resultMessage = null; }, 1500);
},

startInspection(){
  const THREE_MIN = 3 * 60 * 1000;
  const HALF_MIN = .5 * 60 * 1000;
  if(this.inspectionTimerId) clearInterval(this.inspectionTimerId);
  this.inspectionEnd = Date.now() + HALF_MIN;
  this.inspectionActive = true;
  this.inspectionHasBeenTriggered = true;
  localStorage.setItem('pp_inspection_used', 'true');
  this.updateInspectionTick();
  this.inspectionTimerId = setInterval(() => this.updateInspectionTick(), 1000);
  // play claxon and start drum loop
  try{ sfx.claxon(); sfx.startDrums(this.inspectionEnd); }catch(e){console.warn('sfx start failed',e)}
},

updateInspectionTick(){
  const remaining = Math.max(0, this.inspectionEnd - Date.now());
  this.inspectionRemaining = remaining;
  if(remaining <= 0){
    this.stopInspection();
  }
},

stopInspection(){
  if(this.inspectionTimerId) { clearInterval(this.inspectionTimerId); this.inspectionTimerId = null; }
  this.inspectionActive = false;
  this.inspectionEnd = 0;
  this.inspectionRemaining = 0;
  try{ sfx.stopDrums(); sfx.explosion(); }catch(e){}
},

formatTime(ms){
  const s = Math.max(0, Math.ceil(ms/1000));
  const m = Math.floor(s/60);
  const sec = s % 60;
  return m + ':' + String(sec).padStart(2,'0');
},

save(){ localStorage.setItem('pp_teams',JSON.stringify(this.teams)); }
}
}).mount('#app');
</script>

<script>
// Inspection timer helpers bound to the page (ensure they are available)
// The Vue app methods will call startInspection which manages the countdown.
// No global behavior needed here.
</script>

</body>
</html>
